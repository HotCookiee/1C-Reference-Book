package com.example.a1c_reference_book.utils

import com.example.a1c_reference_book.database.AppDatabase
import com.example.a1c_reference_book.database.Article
import com.example.a1c_reference_book.database.Category
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext

class DatabaseSeeder {

    suspend fun seedDatabase(database: AppDatabase) {
        withContext(Dispatchers.IO) {
            val categoryDao = database.categoryDao()
            val articleDao = database.articleDao()

            val categories = listOf(
                Category(id = 1, name = "1С:Бухгалтерия 3.0", icon = "account_balance"),
                Category(id = 2, name = "1С:Управление торговлей 11", icon = "store"),
                Category(id = 3, name = "1С:Зарплата и управление персоналом 3", icon = "people"),
                Category(id = 4, name = "Общие вопросы", icon = "help_outline")
            )

            categories.forEach { category ->
                categoryDao.insertCategory(category)
            }

            val articles = listOf(
                Article(
                    categoryId = 1,
                    title = "Не проводится документ реализации",
                    content = """
                        Решение:
                        1. Проверьте заполнение обязательных полей (контрагент, договор, счёт учёта)
                        2. Убедитесь, что на складе есть остатки товаров
                        3. Проверьте настройки учётной политики
                        4. Попробуйте перепровести документ через меню "Действия" → "Провести"
                        
                        Если не помогло - проверьте журнал регистрации для поиска ошибок.
                    """.trimIndent()
                ),
                Article(
                    categoryId = 1,
                    title = "Ошибка при проведении закрытия месяца",
                    content = """
                        Решение:
                        1. Откройте журнал регистрации и найдите текст ошибки
                        2. Проверьте, все ли документы за месяц проведены
                        3. Убедитесь, что нет документов с будущей датой
                        4. Проверьте правильность настройки счетов учёта
                        5. Выполните регламентную операцию "Переоценка валютных средств" вручную
                        
                        Часто помогает перепроведение всех документов за месяц.
                    """.trimIndent()
                ),
                Article(
                    categoryId = 1,
                    title = "Как сформировать отчёт по взаиморасчётам",
                    content = """
                        Порядок действий:
                        1. Перейдите в раздел "Отчёты" → "Стандартные отчёты"
                        2. Выберите "Оборотно-сальдовая ведомость"
                        3. Укажите счёт 60 (расчёты с поставщиками) или 62 (расчёты с покупателями)
                        4. Установите период
                        5. Включите группировку по контрагентам
                        6. Нажмите "Сформировать"
                        
                        Для детализации дважды кликните по контрагенту.
                    """.trimIndent()
                ),

                Article(
                    categoryId = 2,
                    title = "Как создать новый товар в номенклатуре",
                    content = """
                        Порядок действий:
                        1. Откройте справочник "Номенклатура" (раздел "Справочники" или Ctrl+N)
                        2. Нажмите "Создать" → "Товар"
                        3. Заполните обязательные поля:
                           - Наименование
                           - Артикул
                           - Единица измерения
                           - НДС
                        4. При необходимости укажите:
                           - Штрихкод
                           - Поставщика
                           - Характеристики
                        5. Сохраните (Ctrl+S)
                        
                        Товар сразу доступен для документов!
                    """.trimIndent()
                ),
                Article(
                    categoryId = 2,
                    title = "Расхождение остатков на складе",
                    content = """
                        Диагностика:
                        1. Откройте отчёт "Остатки товаров" на нужную дату
                        2. Сравните с фактическими остатками
                        3. Проверьте документы поступления и реализации за период
                        4. Поищите непроведённые документы
                        
                        Решение:
                        - Если остатки меньше фактических: оформите документ "Оприходование товаров"
                        - Если больше: оформите документ "Списание товаров"
                        - Используйте "Инвентаризацию товаров" для корректировки
                    """.trimIndent()
                ),
                Article(
                    categoryId = 2,
                    title = "Как настроить автоматическое резервирование",
                    content = """
                        Настройка:
                        1. Перейдите в "Главное" → "Настройки" → "Функциональность"
                        2. Найдите раздел "Резервирование товаров"
                        3. Включите опцию "Использовать резервирование"
                        4. Выберите режим:
                           - Автоматически при проведении заказа
                           - Вручную
                        5. Укажите склады для резервирования
                        6. Сохраните настройки
                        
                        Теперь при проведении заказа товары будут резервироваться автоматически.
                    """.trimIndent()
                ),

                Article(
                    categoryId = 3,
                    title = "Как начислить премию сотруднику",
                    content = """
                        Порядок действий:
                        1. Откройте "Зарплата" → "Все начисления"
                        2. Нажмите "Создать" → "Премия"
                        3. Выберите сотрудника
                        4. Укажите месяц начисления
                        5. Выберите вид премии (если не создан - создайте в справочнике)
                        6. Введите сумму или процент от оклада
                        7. Укажите основание (приказ)
                        8. Проведите документ
                        
                        Премия будет учтена при расчёте зарплаты за месяц.
                    """.trimIndent()
                ),
                Article(
                    categoryId = 3,
                    title = "Ошибка при расчёте больничного листа",
                    content = """
                        Частые причины:
                        1. Не указан период нетрудоспособности
                        2. Неправильный стаж для расчёта
                        3. Отсутствуют данные по заработку за расчётный период
                        
                        Решение:
                        1. Проверьте даты больничного
                        2. Уточните стаж сотрудника (вкладка "Стаж")
                        3. Убедитесь, что начисления за предыдущие 2 года проведены
                        4. Проверьте настройки расчёта больничных в учётной политике
                        5. Перепроведите документ
                        
                        При необходимости заполните вручную средний заработок.
                    """.trimIndent()
                ),

                Article(
                    categoryId = 4,
                    title = "Как обновить платформу 1С",
                    content = """
                        Порядок действий:
                        1. Скачайте актуальный релиз с сайта users.v8.1c.ru
                        2. Закройте все базы 1С
                        3. Запустите установщик
                        4. Выберите "Обновить существующую установку"
                        5. Дождитесь завершения установки
                        6. Перезагрузите компьютер (рекомендуется)
                        7. Запустите 1С и проверьте версию (Справка → О программе)
                        
                        Важно: сделайте резервную копию баз перед обновлением!
                    """.trimIndent()
                ),
                Article(
                    categoryId = 4,
                    title = "Медленно работает 1С - что делать",
                    content = """
                        Диагностика:
                        1. Проверьте замер производительности (Ctrl+Shift+F11)
                        2. Откройте "Администрирование" → "Тестирование и исправление"
                        3. Выполните тест базы данных
                        
                        Решение:
                        1. Выполните перестроение индексов (ТиИ → "Перестроить индексы")
                        2. Сожмите базу данных (ТиИ → "Сжать базу")
                        3. Проверьте место на диске (должно быть >10% свободно)
                        4. Убедитесь, что антивирус не сканирует папку с базой
                        5. При работе в серверном режиме - проверьте настройки SQL Server
                        
                        Если не помогло - обратитесь к администратору для анализа производительности.
                    """.trimIndent()
                ),
                Article(
                    categoryId = 4,
                    title = "Как сделать резервную копию базы",
                    content = """
                        Способ 1 (через конфигуратор):
                        1. Запустите 1С в режиме конфигуратора
                        2. Меню "Администрирование" → "Выгрузить информационную базу"
                        3. Укажите путь и имя файла (расширение .dt)
                        4. Дождитесь завершения выгрузки
                        
                        Способ 2 (копирование файлов):
                        1. Закройте все сеансы 1С
                        2. Скопируйте папку с базой данных целиком
                        3. Сохраните в безопасное место
                        
                        Рекомендация: настройте автоматическое резервное копирование раз в день.
                    """.trimIndent()
                )
            )
            articles.forEach { article ->
                articleDao.insertArticle(article)
            }
        }
    }
}
