package com.example.a1c_reference_book.utils

import com.example.a1c_reference_book.database.AppDatabase
import com.example.a1c_reference_book.database.Article
import com.example.a1c_reference_book.database.Category
import kotlinx.coroutines.flow.first

object DatabaseSeeder {

    suspend fun seedDatabase(database: AppDatabase) {
        val categoryDao = database.categoryDao()
        val articleDao = database.articleDao()

        val existingCategories = categoryDao.getAllCategories().first()

        if (existingCategories.isNotEmpty()) {
            return
        }

        val categories = listOf(
            Category(name = "1С:Бухгалтерия 3.0", icon = "account_balance"),
            Category(name = "1С:Управление торговлей 11", icon = "store"),
            Category(name = "1С:Зарплата и управление персоналом 3", icon = "people"),
            Category(name = "Общие вопросы", icon = "help_outline")
        )

        categories.forEach { categoryDao.insertCategory(it) }

        val buhArticles = listOf(
            Article(
                categoryId = 1,
                title = "Как провести закрытие месяца",
                content = """
                    Закрытие месяца — критически важная операция.
                    
                    Шаги:
                    1. Меню "Операции" → "Закрытие месяца"
                    2. Выберите месяц и нажмите "Выполнить закрытие"
                    3. Проверьте отчёт о закрытии на ошибки
                    4. Исправьте ошибки и повторите закрытие
                    
                    Частые ошибки:
                    - Не проведены все документы
                    - Не заполнены реквизиты контрагентов
                    - Не введены курсы валют
                    
                    Важно: Делайте резервную копию перед закрытием!
                """.trimIndent()
            ),
            Article(
                categoryId = 1,
                title = "Ошибка при проведении платёжного поручения",
                content = """
                    Если платёжка не проводится, проверьте:
                    
                    1. Заполнены ли все обязательные реквизиты (получатель, сумма, назначение платежа)
                    2. Указан ли правильный банковский счёт
                    3. Есть ли доступный остаток на счёте
                    4. Совпадает ли валюта документа и счёта
                    
                    Если всё правильно, но ошибка остаётся:
                    - Проверьте права пользователя
                    - Перезапустите 1С
                    - Проверьте целостность базы через "Тестирование и исправление"
                """.trimIndent()
            ),
            Article(
                categoryId = 1,
                title = "Настройка учётной политики",
                content = """
                    Учётная политика настраивается один раз при внедрении.
                    
                    Путь: Главное → Настройки → Учётная политика
                    
                    Основные параметры:
                    - Метод оценки МПЗ (ФИФО, средняя)
                    - Способ начисления амортизации ОС
                    - Применение ПБУ 18/02
                    - УСН или ОСНО
                    
                    После изменения учётной политики рекомендуется:
                    1. Сделать полное перепроведение документов
                    2. Проверить остатки по счетам
                    3. Сверить отчёты с предыдущим периодом
                """.trimIndent()
            ),
            Article(
                categoryId = 1,
                title = "Формирование отчётности в налоговую",
                content = """
                    Для сдачи отчётов в ИФНС используйте регламентированные отчёты.
                    
                    Путь: Отчёты → Регламентированные отчёты
                    
                    Перед формированием:
                    1. Закройте месяц/квартал
                    2. Проверьте контрольные соотношения
                    3. Сверьте данные с карточками счетов
                    
                    Для отправки в ФНС:
                    - Установите модуль "1С-Отчётность"
                    - Получите сертификат ЭЦП
                    - Настройте параметры отправки
                    
                    Отчёты сохраняются в базе и доступны для повторной печати.
                """.trimIndent()
            ),
            Article(
                categoryId = 1,
                title = "Учёт НДС: проблемы и решения",
                content = """
                    Типичные проблемы с НДС:
                    
                    1. НДС не попадает в книгу покупок
                    Решение: Проверьте, что у документа стоит галочка "НДС учитывается" и заполнен счёт-фактура
                    
                    2. Расхождения с контрагентом
                    Решение: Сверьте счета-фактуры, даты и суммы
                    
                    3. НДС висит к возмещению
                    Решение: Проведите зачёт НДС через документ "Формирование записей книги покупок"
                    
                    4. Ошибка при выгрузке в декларацию
                    Решение: Проверьте ИНН/КПП контрагентов
                """.trimIndent()
            ),
            Article(
                categoryId = 1,
                title = "Инвентаризация товаров на складе",
                content = """
                    Инвентаризация проводится минимум раз в год перед годовым отчётом.
                    
                    Порядок действий:
                    1. Создайте документ "Инвентаризация товаров на складе"
                    2. Заполните фактические остатки
                    3. Система автоматически покажет расхождения
                    4. Оформите излишки/недостачу отдельными документами
                    
                    Типы расхождений:
                    - Излишки → "Оприходование товаров"
                    - Недостача → "Списание товаров"
                    
                    Важно: Недостачу можно отнести на виновное лицо через зарплату.
                """.trimIndent()
            ),
            Article(
                categoryId = 1,
                title = "Как исправить неправильную проводку",
                content = """
                    Способы исправления проводок:
                    
                    Способ 1: Отмена проведения
                    - Найдите документ
                    - Снимите проведение
                    - Исправьте данные
                    - Проведите заново
                    
                    Способ 2: Сторнирующая проводка
                    - Создайте операцию вручную
                    - Введите проводку с минусом (сторно)
                    - Создайте правильную проводку
                    
                    Способ 3: Через "Операции введённые вручную"
                    - Создайте корректирующую операцию
                    - Укажите правильные счета и суммы
                    
                    Не забудьте перепровести закрытие месяца после исправлений!
                """.trimIndent()
            ),
            Article(
                categoryId = 1,
                title = "Работа с кассовыми операциями",
                content = """
                    Кассовые документы строго регламентированы законом.
                    
                    Основные документы:
                    - Приходный кассовый ордер (ПКО)
                    - Расходный кассовый ордер (РКО)
                    - Кассовая книга
                    
                    Лимит кассы:
                    Устанавливается приказом руководителя. Превышение лимита — штраф!
                    
                    Частые ошибки:
                    1. Нет подписи получателя в РКО
                    2. Не указано основание выдачи
                    3. Не сформирована кассовая книга
                    
                    Отчёт "Кассовая книга" формируется ежедневно!
                """.trimIndent()
            )
        )

        val utArticles = listOf(
            Article(
                categoryId = 2,
                title = "Настройка прайс-листов и цен",
                content = """
                    Управление ценами — ключевая функция в УТ.
                    
                    Типы цен:
                    - Базовая цена
                    - Розничная цена
                    - Оптовая цена
                    - Цены по скидкам
                    
                    Настройка:
                    1. НСИ → Цены → Типы цен номенклатуры
                    2. Создайте нужные типы цен
                    3. Установите цены через "Установка цен номенклатуры"
                    
                    Массовое изменение:
                    - Обработка "Изменение цен"
                    - Можно увеличить/уменьшить на % или сумму
                    - Округление цен
                    
                    Цены можно привязать к контрагентам и договорам!
                """.trimIndent()
            ),
            Article(
                categoryId = 2,
                title = "Формирование заказа поставщику",
                content = """
                    Заказ поставщику — начало цепочки закупки.
                    
                    Порядок:
                    1. Продажи → Заказы поставщикам → Создать
                    2. Выберите поставщика
                    3. Добавьте номенклатуру и количество
                    4. Укажите условия поставки
                    5. Проведите документ
                    
                    На основании заказа создаются:
                    - Поступление товаров
                    - Счёт на оплату
                    
                    Контроль выполнения:
                    Отчёт "Заказы поставщикам" покажет невыполненные заказы.
                    
                    Можно настроить автозаказ по остаткам!
                """.trimIndent()
            ),
            Article(
                categoryId = 2,
                title = "Возврат товара от покупателя",
                content = """
                    Возврат товара — частая операция в рознице и опте.
                    
                    Варианты возврата:
                    1. Возврат качественного товара (в течение 14 дней)
                    2. Возврат бракованного товара
                    3. Возврат товара по пересортице
                    
                    Оформление:
                    - Документ "Возврат товаров от клиента"
                    - Указать основание (реализацию)
                    - Выбрать товары для возврата
                    - Оформить возврат денег или корректировку долга
                    
                    Важно:
                    - Товар возвращается на тот же склад
                    - НДС корректируется автоматически
                    - Проверьте срок возврата по закону!
                """.trimIndent()
            ),
            Article(
                categoryId = 2,
                title = "Работа с серийными номерами",
                content = """
                    Серийный учёт используется для электроники, оборудования, автомобилей.
                    
                    Настройка:
                    1. НСИ → Номенклатура → Выберите товар
                    2. Установите галочку "Серийные номера"
                    
                    При операциях:
                    - Поступление: укажите серийные номера
                    - Реализация: выберите конкретные номера со склада
                    - Инвентаризация: проверяйте серийники
                    
                    Преимущества:
                    - Полная прослеживаемость
                    - Гарантийный учёт
                    - Контроль качества
                    
                    Отчёт "Остатки по серийным номерам" покажет, где находится каждая единица.
                """.trimIndent()
            ),
            Article(
                categoryId = 2,
                title = "Резервирование товаров под заказы",
                content = """
                    Резервирование гарантирует, что товар не продадут другому клиенту.
                    
                    Автоматическое резервирование:
                    1. Настройки → Продажи → Резервирование
                    2. Включите "Резервировать автоматически"
                    
                    Ручное резервирование:
                    - В заказе клиента нажмите "Зарезервировать"
                    - Выберите склад и партии
                    
                    Контроль резервов:
                    - Отчёт "Резервы товаров"
                    - Показывает, что зарезервировано и на каком складе
                    
                    Снятие резерва:
                    - Автоматически при отгрузке
                    - Вручную при отмене заказа
                """.trimIndent()
            ),
            Article(
                categoryId = 2,
                title = "Перемещение товаров между складами",
                content = """
                    Перемещение — перенос товара с одного склада на другой без смены собственника.
                    
                    Создание документа:
                    1. Склад → Перемещение товаров
                    2. Укажите склад отправитель и получатель
                    3. Выберите номенклатуру
                    4. Проведите документ
                    
                    Типы перемещений:
                    - Между розничными точками
                    - Со склада в магазин
                    - Между филиалами
                    
                    Важно:
                    - Проверяйте наличие на складе-отправителе
                    - Учитывайте серийные номера
                    - Для межфилиальных перемещений нужна доверенность
                    
                    Отчёт "Перемещения товаров" покажет историю.
                """.trimIndent()
            ),
            Article(
                categoryId = 2,
                title = "Работа с маркированными товарами",
                content = """
                    С 2019 года многие товары подлежат обязательной маркировке.
                    
                    Категории товаров:
                    - Обувь
                    - Лекарства
                    - Табак
                    - Одежда
                    - Парфюмерия
                    
                    Работа с кодами:
                    1. При поступлении сканируйте DataMatrix коды
                    2. Система регистрирует их в базе
                    3. При продаже коды выводятся из оборота
                    4. Отчёты передаются в Честный ЗНАК
                    
                    Требуется:
                    - 2D сканер
                    - Интеграция с ОФД
                    - Электронная подпись
                    
                    Штрафы за нарушения до 300 000 руб!
                """.trimIndent()
            ),
            Article(
                categoryId = 2,
                title = "Акты сверки с контрагентами",
                content = """
                    Акт сверки — документ, подтверждающий взаимные расчёты.
                    
                    Формирование:
                    1. Продажи → Акты сверки → Создать
                    2. Выберите контрагента и период
                    3. Система сформирует таблицу операций
                    4. Распечатайте в 2 экземплярах
                    5. Получите подпись контрагента
                    
                    Что проверять:
                    - Начальное сальдо
                    - Все документы за период
                    - Конечное сальдо
                    - Расхождения
                    
                    При расхождениях:
                    - Запросите копии документов
                    - Оформите корректировки
                    - Пересогласуйте акт
                    
                    Рекомендуется делать ежемесячно или ежеквартально!
                """.trimIndent()
            )
        )

        val zupArticles = listOf(
            Article(
                categoryId = 3,
                title = "Начисление зарплаты за месяц",
                content = """
                    Начисление зарплаты — ежемесячная процедура.
                    
                    Порядок действий:
                    1. Зарплата → Начисление зарплаты → Создать
                    2. Выберите месяц и подразделение
                    3. Нажмите "Заполнить" — данные подтянутся автоматически
                    4. Проверьте табель рабочего времени
                    5. Добавьте премии, надбавки, удержания
                    6. Проведите документ
                    
                    Автоматически рассчитываются:
                    - НДФЛ 13%
                    - Страховые взносы (30%)
                    - Удержания по исполнительным листам
                    
                    После начисления формируйте ведомость на выплату!
                """.trimIndent()
            ),
            Article(
                categoryId = 3,
                title = "Оформление отпуска сотрудника",
                content = """
                    Отпуск оформляется минимум за 2 недели до начала.
                    
                    Этапы:
                    1. Кадры → Отпуска → Создать документ "Отпуск"
                    2. Выберите сотрудника
                    3. Укажите даты начала и окончания
                    4. Тип отпуска (ежегодный, учебный, без сохранения)
                    5. Проведите документ
                    
                    Расчёт отпускных:
                    - Средний заработок за 12 месяцев
                    - Делится на 29,3 (среднее число дней в месяце)
                    - Умножается на дни отпуска
                    
                    Отпускные выплачиваются за 3 дня до начала отпуска!
                    
                    Не забудьте приказ по форме Т-6!
                """.trimIndent()
            ),
            Article(
                categoryId = 3,
                title = "Больничный лист: расчёт и оплата",
                content = """
                    Больничные оплачиваются из ФСС частично.
                    
                    Оформление:
                    1. Кадры → Больничные листы → Создать
                    2. Введите номер ЭЛН (электронного листка нетрудоспособности)
                    3. Укажите даты болезни
                    4. Выберите причину (заболевание, травма, уход за ребёнком)
                    5. Система рассчитает сумму автоматически
                    
                    Расчёт:
                    - Первые 3 дня — за счёт работодателя
                    - С 4 дня — за счёт ФСС
                    - % оплаты зависит от стажа (60%, 80%, 100%)
                    
                    Данные передаются в ФСС автоматически через личный кабинет!
                """.trimIndent()
            ),
            Article(
                categoryId = 3,
                title = "Приём на работу нового сотрудника",
                content = """
                    Приём сотрудника — многоэтапный процесс.
                    
                    Документы от сотрудника:
                    - Паспорт
                    - СНИЛС
                    - ИНН
                    - Трудовая книжка (или СТД-Р)
                    - Военный билет (для мужчин до 27 лет)
                    - Диплом (если нужен)
                    
                    Оформление в 1С:
                    1. Кадры → Приём на работу → Создать
                    2. Заполните личные данные
                    3. Укажите должность, подразделение, оклад
                    4. Выберите график работы
                    5. Проведите документ
                    
                    Автоматически создаются:
                    - Приказ о приёме (Т-1)
                    - Личная карточка (Т-2)
                    - Запись в трудовую книжку (СЗВ-ТД)
                """.trimIndent()
            ),
            Article(
                categoryId = 3,
                title = "Увольнение сотрудника по собственному желанию",
                content = """
                    Увольнение оформляется после заявления сотрудника.
                    
                    Сроки:
                    - Отработка 2 недели (стандарт)
                    - Без отработки (по соглашению сторон)
                    
                    Оформление:
                    1. Кадры → Увольнение → Создать
                    2. Выберите сотрудника
                    3. Укажите дату и основание (ст. 77 ТК РФ)
                    4. Проведите документ
                    
                    Расчёт при увольнении:
                    - Зарплата за отработанные дни
                    - Компенсация за неиспользованный отпуск
                    - Премии (если положены)
                    
                    В последний день выдать:
                    - Трудовую книжку
                    - Справку 2-НДФЛ
                    - СТД-Р
                    - Расчётный лист
                """.trimIndent()
            ),
            Article(
                categoryId = 3,
                title = "Командировочные расходы",
                content = """
                    Командировка — служебная поездка сотрудника.
                    
                    Оформление:
                    1. Кадры → Командировки → Создать
                    2. Укажите место и цель командировки
                    3. Даты начала и окончания
                    4. Проведите приказ (Т-9)
                    
                    Расходы:
                    - Суточные (700 руб/день по РФ, 2500 руб/день за границей)
                    - Проезд (билеты)
                    - Проживание (гостиница)
                    - Прочие расходы (такси, связь)
                    
                    Отчёт о командировке:
                    Сотрудник предоставляет в течение 3 дней после возвращения с чеками и билетами.
                    
                    Суточные не облагаются НДФЛ!
                """.trimIndent()
            ),
            Article(
                categoryId = 3,
                title = "Учёт рабочего времени в табеле",
                content = """
                    Табель — основа для расчёта зарплаты.
                    
                    Создание:
                    1. Зарплата → Табель учёта рабочего времени
                    2. Выберите месяц и подразделение
                    3. Нажмите "Заполнить" — по графику
                    4. Внесите отклонения (отпуска, больничные, прогулы)
                    
                    Условные обозначения:
                    - Я (8) — явка, 8 часов
                    - ОТ — отпуск
                    - Б — больничный
                    - К — командировка
                    - НН — неявка по невыясненным причинам
                    - ПР — прогул
                    
                    Табель утверждается руководителем и передаётся в бухгалтерию до 5 числа!
                """.trimIndent()
            ),
            Article(
                categoryId = 3,
                title = "Индексация заработной платы",
                content = """
                    Индексация — обязательное повышение зарплат по инфляции.
                    
                    Порядок:
                    1. Издайте приказ об индексации
                    2. Укажите % повышения и дату начала
                    3. В 1С: Кадры → Массовое изменение реквизитов
                    4. Выберите "Плановые начисления"
                    5. Укажите повышение на % или сумму
                    6. Примените ко всем или выборочно
                    
                    Рекомендуемые сроки:
                    - 1 раз в год
                    - % не менее официальной инфляции
                    
                    Индексация должна быть прописана в коллективном договоре или локальном акте!
                    
                    Не забудьте уведомить сотрудников письменно за 2 месяца.
                """.trimIndent()
            )
        )

        val generalArticles = listOf(
            Article(
                categoryId = 4,
                title = "Резервное копирование базы данных",
                content = """
                    Резервная копия — защита от потери данных.
                    
                    Как создать копию:
                    1. Меню "Файл" → "Сохранить копию"
                    2. Выберите путь для сохранения
                    3. Дождитесь завершения (может занять 5-10 минут)
                    
                    Автоматическое копирование:
                    - Настраивается в серверной версии
                    - Копии создаются по расписанию (обычно ночью)
                    - Хранятся на отдельном диске/сервере
                    
                    Рекомендации:
                    - Делайте копии ежедневно
                    - Храните минимум 7 последних копий
                    - Периодически проверяйте восстановление
                    - Храните копии вне офиса (облако, другой сервер)
                    
                    Копия перед важными операциями обязательна!
                """.trimIndent()
            ),
            Article(
                categoryId = 4,
                title = "Обновление конфигурации 1С",
                content = """
                    Обновления выходят регулярно и содержат исправления и новые функции.
                    
                    Порядок обновления:
                    1. Сделайте резервную копию!
                    2. Меню "Конфигурация" → "Поддержка" → "Обновление конфигурации"
                    3. Скачайте обновление с сайта 1С
                    4. Загрузите файл обновления (.cfu)
                    5. Примените обновление
                    6. Обновите конфигурацию БД
                    
                    После обновления:
                    - Проверьте типовые операции
                    - Прочитайте список изменений
                    - Обучите пользователей новым функциям
                    
                    Важно: Обновляйтесь минимум раз в квартал для соответствия законодательству!
                """.trimIndent()
            ),
            Article(
                categoryId = 4,
                title = "Настройка прав пользователей",
                content = """
                    Права определяют, что может делать каждый пользователь.
                    
                    Создание пользователя:
                    1. Администрирование → Пользователи → Создать
                    2. Укажите ФИО и логин
                    3. Установите пароль
                    4. Назначьте роли
                    
                    Типовые роли:
                    - Администратор (полный доступ)
                    - Бухгалтер (учёт, отчёты)
                    - Кассир (кассовые операции)
                    - Кладовщик (склад, товары)
                    - Менеджер по продажам (заказы, реализации)
                    
                    Принцип минимальных прав:
                    Давайте только те права, которые реально нужны для работы!
                    
                    Можно создавать свои роли с уникальным набором прав.
                """.trimIndent()
            ),
            Article(
                categoryId = 4,
                title = "Тестирование и исправление базы данных",
                content = """
                    Тестирование находит и исправляет ошибки в базе.
                    
                    Когда использовать:
                    - Программа тормозит
                    - Документы не проводятся
                    - Отчёты выдают ошибки
                    - После аварийного завершения
                    
                    Как запустить:
                    1. Закройте базу для всех пользователей
                    2. Запустите в режиме "1С:Предприятие"
                    3. Администрирование → Тестирование и исправление
                    4. Выберите "Выполнить проверку"
                    5. Если найдены ошибки — исправьте
                    
                    Режимы:
                    - Только проверка (быстро, без изменений)
                    - Проверка и исправление (медленно, исправляет проблемы)
                    
                    Делайте перед сдачей отчётности!
                """.trimIndent()
            ),
            Article(
                categoryId = 4,
                title = "Работа с печатными формами",
                content = """
                    Печатные формы — документы для распечатки (накладные, акты, счета).
                    
                    Стандартная печать:
                    1. Откройте документ
                    2. Нажмите кнопку "Печать"
                    3. Выберите нужную форму
                    4. Документ откроется в Word/Excel/PDF
                    
                    Настройка форм:
                    - Можно изменить макеты через конфигуратор
                    - Добавить логотип компании
                    - Изменить текст и реквизиты
                    
                    Массовая печать:
                    - Выделите несколько документов
                    - Печать → Комплект документов
                    
                    Внешние печатные формы:
                    Можно загрузить готовые формы с сайта 1С или разработать свои!
                """.trimIndent()
            )
        )

        (buhArticles + utArticles + zupArticles + generalArticles).forEach {
            articleDao.insertArticle(it)
        }
    }
}
